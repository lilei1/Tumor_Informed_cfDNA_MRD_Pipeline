// Nextflow configuration file for Tumor-Informed cfDNA MRD Pipeline

// AWS configuration
aws {
    region = 'us-east-1'
    batch {
        maxTransferAttempts = 3
        maxParallelTransfers = 10
    }
}

// Docker configuration
docker {
    enabled = true
    runOptions = '-u $(id -u):$(id -g)'
}

// Process configuration
process {
    // Default resource requirements
    cpus = 1
    memory = '4 GB'
    time = '2h'
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 3
    
    // Publish results
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" },
        mode: 'copy',
        pattern: '*.{vcf,bam,bai,bed,txt,csv,pdf,png,html,json}'
    ]
}

// Executor configuration
executor {
    name = 'awsbatch'
    queueSize = 100
    pollInterval = '30 sec'
    dumpInterval = '5 min'
    queueStatInterval = '5 min'
    perJobMemLimit = true
    awscli = '/usr/local/bin/aws'
}

// Parameters
params {
    // Input directories
    tumorDir = "$baseDir/wes/tumor"
    normalDir = "$baseDir/wes/normal"
    plasmaDir = "$baseDir/plasma/patients"
    healthyDir = "$baseDir/plasma/healthy"
    
    // Reference files
    genome = "$baseDir/refs/GRCh38.fa"
    exomeBed = "$baseDir/resources/exome.interval_list"
    gnomadVcf = "$baseDir/resources/gnomad.af-only.vcf.gz"
    ponVcf = "$baseDir/pon/pon.vcf.gz"
    dmrBed = "$baseDir/resources/dmr.bed"
    tssBed = "$baseDir/resources/tss.bed"
    
    // Output directory
    outdir = "$baseDir/results"
    
    // Analysis parameters
    minVaf = 0.001
    minDepth = 50
    minTlod = 6
    minAd = 5
    umiLength = 8
    consensusThreshold = 0.8
    
    // AWS resources
    maxCpus = 32
    maxMemory = '128 GB'
    
    // Help
    help = false
}

// Report configuration
report {
    enabled = true
    file = "$params.outdir/pipeline_report.html"
}

// Timeline configuration
timeline {
    enabled = true
    file = "$params.outdir/timeline_report.html"
}

// Trace configuration
trace {
    enabled = true
    file = "$params.outdir/trace.txt"
}

// Manifest configuration
manifest {
    name = 'tumor-informed-cfdna-mrd-pipeline'
    author = 'Your Name'
    description = 'Pipeline for detecting MRD in CRC patients using tumor-informed cfDNA analysis'
    version = '1.0.0'
    nextflowVersion = '>=22.10.0'
}
